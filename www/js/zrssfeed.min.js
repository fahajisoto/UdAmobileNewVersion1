(function(e){e.fn.rssfeed=function(r,i,s){i=e.extend({limit:10,offset:1,header:!0,titletag:"h4",date:!0,dateformat:"datetime",content:!0,snippet:!0,media:!0,showerror:!0,errormsg:"",key:null,ssl:!1,linktarget:"_self",linkredirect:"",linkcontent:!1,sort:"",sortasc:!0,historical:!1},i);return this.each(function(o,u){var a=e(u),f="";i.ssl&&(f="s");a.hasClass("rssFeed")||a.addClass("rssFeed");if(null==r)return!1;0<i.offset&&(i.offset-=1);i.limit+=i.offset;f="http"+f+"://ajax.googleapis.com/ajax/services/feed/load?v=1.0&callback=?&q="+encodeURIComponent(r);f+="&num="+i.limit;i.historical&&(f+="&scoring=h");null!=i.key&&(f+="&key="+i.key);e.getJSON(f+"&output=json_xml",function(r){if(200==r.responseStatus){var o=r.responseData,f=i;if(r=o.feed){var c=[],d=0,v="",m="odd";if(f.media){var g=o.xmlString;"Microsoft Internet Explorer"==navigator.appName?(d=new ActiveXObject("Microsoft.XMLDOM"),d.async="false",d.loadXML(g)):d=(new DOMParser).parseFromString(g,"text/xml");g=d.getElementsByTagName("item")}f.header&&(v+='<div class="rssHeader"><a href="'+r.link+'" title="'+r.description+'">'+r.title+"</a></div>");v+='<div class="rssBody"><ul>';for(o=f.offset;o<r.entries.length;o++){d=o-f.offset;c[d]=[];var y=r.entries[o],b,E="",S=y.link;switch(f.sort){case"title":E=y.title;break;case"date":E=y.publishedDate}c[d].sort=E;if(y.publishedDate)switch(E=new Date(y.publishedDate),b=E.toLocaleDateString()+" "+E.toLocaleTimeString(),f.dateformat){case"datetime":break;case"date":b=E.toLocaleDateString();break;case"time":b=E.toLocaleTimeString();break;case"timeline":b=new Date(E);b=Math.round(((new Date).getTime()-b.getTime())/1e3);60>b?b="< 1 min":(3600>b?(b=Math.round(b/60)-1,E="min"):86400>b?(b=Math.round(b/3600)-1,E="hour"):604800>b?(b=Math.round(b/86400)-1,E="day"):(b=Math.round(b/604800)-1,E="week"),1<b&&(E+="s"),b=b+" "+E);break;default:b=E,E=new Date(b),b=f.dateformat,b=b.replace("dd",t(E.getDate())),b=b.replace("MMMM",n(E.getMonth())),b=b.replace("MM",t(E.getMonth()+1)),b=b.replace("yyyy",E.getFullYear()),b=b.replace("hh",t(E.getHours())),b=b.replace("mm",t(E.getMinutes())),b=b.replace("ss",t(E.getSeconds()))}f.linkredirect&&(S=encodeURIComponent(S));c[d].html="<"+f.titletag+'><a href="'+f.linkredirect+S+'" title="View this feed at '+r.title+'">'+y.title+"</a></"+f.titletag+">";f.date&&b&&(c[d].html+="<div>"+b+"</div>");f.content&&(y=f.snippet&&""!=y.contentSnippet?y.contentSnippet:y.content,f.linkcontent&&(y='<a href="'+f.linkredirect+S+'" title="View this feed at '+r.title+'">'+y+"</a>"),c[d].html+="<p>"+y+"</p>");if(f.media&&0<g.length&&(S=g[o].getElementsByTagName("enclosure"),0<S.length)){c[d].html+='<div class="rssMedia"><div>Media files</div><ul>';for(y=0;y<S.length;y++){var T=S[y].getAttribute("url"),N=S[y].getAttribute("type"),C=S[y].getAttribute("length"),E=c[d],k=c[d].html,T='<li><a href="'+T+'" title="Download this media">'+T.split("/").pop()+"</a> ("+N+", ",N=Math.floor(Math.log(C)/Math.log(1024)),C=(C/Math.pow(1024,Math.floor(N))).toFixed(2)+" "+"bytes kb MB GB TB PB".split(" ")[N];E.html=k+(T+C+")</li>")}c[d].html+="</ul></div>"}}f.sort&&c.sort(function(e,t){if(f.sortasc)var n=e.sort,r=t.sort;else n=t.sort,r=e.sort;if("date"==f.sort)return new Date(n)-new Date(r);n=n.toLowerCase();r=r.toLowerCase();return n<r?-1:n>r?1:0});e.each(c,function(e){v+='<li class="rssRow '+m+'"><div class="rssContent">'+c[e].html+"</div></li>";m="odd"==m?"even":"odd"});v+="</ul></div>";e(u).html(v);e("a",u).attr("target",f.linktarget)}e.isFunction(s)&&s.call(this,a)}else i.showerror&&(d=""!=i.errormsg?i.errormsg:r.responseDetails),e(u).html('<div class="rssError"><p>'+d+"</p></div>")})})};var t=function(e){e+="";2>e.length&&(e="0"+e);return e},n=function(e){return"Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" ")[e]}})(jQuery)